# 서비스 운영을 위한 자바스크립트 패키지

## 서비스 운영을 위한 자바스크립트 패키지 \| Operation Tool 

서비스를 개발 할 때는 dev환경\(개발환경\)에서 개발이 더 쉽게 하도록 nodemon과 같은 dev tool을 이용합니다. 이와 마찬가지로 서버를 운영할 때도 **서비스 운영\(Operation\)을 위한 패키지**가 있습니다.

 이런 패키지는 서비스의 취약점을 노린 공격을 막아주며, 서버가 꺼졌을 때 다시 실행시켜주는 등의 기능을 합니다.

### pm2 \| 원활한 서버 운영을 위한 패키지

 개발할 때 nodemon을 통해서 코드가 수정될 때 마다 프로그램을 다시 실행시켜주었습니다. 이와 비슷하게 서버가 운영될 때에는 pm2라는 패키지를 많이 사용합니다. 노드몬과 비슷하게 서버가 에러로 꺼졌을 때 서버를 다시 켜주는 역할을 합니다.

```bash
$npm i -g pm2
$npm i pm2
```

```javascript
{
(...)
    "start" : "NODE_ENV=prodution PORT=80 pm2 start app.js"
(...)
}
```

####  자주 사용하는 pm2 명령어

| 구분  | 설명  |
| :--- | :--- |
| **npm i pm2 -g** | npm을 통해서 pm2를 전역 설치하는 방법 |
| **pm2 start "node.js file"** | pm2를 이용해 Node.js애플리케이션을 관리하는 것을 시작하는 명령어 |
| **pm2 monit** | pm2로 인해 실행되는 프로그램을 보여주는 명령어  |
| **pm2 list** | pm2로 돌아가는 애플리케이션의 리스트를 보여주는 명령어  |
| **pm2 log** | pm2를 이용하여 해당 애플리케이션의 수정 사항을 기록하는 명령어. 에러나 수정사항등을 확인할 수 있다. |
| **pm2 reload all** | pm2를 이용하여 서버를 재시작하고 싶을 때 사용하는 명령어 |
| **pm2 kill**  | pm2로 실행한 모든 프로세스를 중지 및 삭제하는 명령어  |
| **pm2 start " node.js file" --watch** | pm2를 이용해 해당 애플리케이션의 수정 사항을 바로바로 보여주는 명령어 |

#### pm2의 멀티프로세싱 지원 

 pm2는 서버의 멀티 프로세싱을 지원합니다. 즉 멀티 CPU 기계에서 1개 이상의 CPU 코어를 사용할 수 있습니다. 따라서 노드는 클라이언트로 부터 요청이 왔을 때 여러 노드 프로세스에 요청을 분배합니다.

 이로 인해 서비스에 무리가 가지 않고, 서비스를 더 원활하게 운영할 수 있습니다. 

다만, 멀티 스레딩이 아닌 멀티 프로세싱을 지원하기에 코어간에 메모리 자원을 공유할 수 없습니다. 따라서 레디스와 같이 별도로 세션을 저장하여 사용할 수 있는 데이터베이스에 세션 정보를 기록하는 방식으로 설계하는 것이 좋습니다. 

### winston 

 실제 서버를 동작할 때 에러나 특정 로그 파일들을 데이터베이스에 저장하기 위해 사용하는 자바스크립트 패키지입니다. 

```bash
$npm i winston@next
```

 보통 서버를 개발할 당시에는 console.log나 console.error와 같은 console객체를 이용하지만 서버가 운영될 때는 console객체가 언제 발생했는지 파악하기 어렵고, 서버가 종료되면 로그들이 사라지기 때문에 winston을 사용하여 로그를 데이터 베이스에 저장하는 것이 좋습니다.

### Redis \| Remote Dictionary Server

 레디스는 **'키-값' 구조의 비정형 데이터를 저장하고 관리하기 위한 오픈소스 기반의 비관계형 데이터베이스 관리 시스템\(DBMS\)**입니다.

 보통 배포용 서버를 운영할 때 멀티 프로세싱으로 인한 세션 스토어의 공유를 위해서 사용합니다.  또한, 서버가 종료되어 접속자들이 동시에 로그아웃되는 것을 막아줍니다. 

```bash
$npm i connect-redis 
```

 익스프레스에서는 connect-redis 라는 패키지를 통해서 레디스와 익스프레스를 연결할 수 있습니다. 다만, Redis를 사용하기 위해서는 별도의 레디스 데이터베이스를 설치해야합니다.

### helmet, hpp

 서버의 각종 취약점을 보완해주는 패키지로 익스프레스 미들웨어로서 사용할 수 있습니다.

```bash
$npm i helmet
$npm i hpp
```

 배포 시에만 적용하면 되고 익스프레스에서 사용하기 위해서는 다음과 같이 간단하게 사용할 수 있습니다.

```javascript
...
const helmet = require('helmet');
const hpp = require('hpp');
...
...
app.use(helmet());
app.use(hpp());
...
```

 해당 패키지는 서버를 운영할 때 주기적으로 취약점을 점검해주며 공식문서를 참조해보는 것이 좋습니다.

### nvm과 n

 서버에서 운영되는 노드 버전을 업데이트 하기 위한 패키지입니다. 윈도우에서는 nvm을 사용하고 리눅스나 맥에서는 n패키지를 사용하는 편입니다.

